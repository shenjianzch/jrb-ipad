webpackJsonp([13],{RmBz:function(t,e){},hO9y:function(t,e,i){"use strict";function a(t){i("RmBz")}Object.defineProperty(e,"__esModule",{value:!0});var s=i("Xxa5"),n=i.n(s),o=i("exGp"),r=i.n(o),c=i("//Fk"),l=i.n(c),d=i("Dd8w"),u=i.n(d),p=i("NYxO"),m=i("c84w"),h=i("VkJr"),f={data:function(){return{form:{item_id:"",employee_id:"",paid_at:"",account_id:"",remark:"",shop_id:""},created_at:(new Date).getTime(),isAdd:!1,showCustom:!1,project:[],methods:[],custome:""}},props:["show","type"],components:{hmtPayment:function(){return i.e(1).then(i.bind(null,"MS3l"))}},computed:u()({dshow:{get:function(){return this.show},set:function(t){this.$emit("update:show",t)}},title:function(){return"income"==this.type?"新增收款单":"新建付款单"},desc:function(){return"income"==this.type?"收款明细":"付款明细"},chooseType:function(){return"income"==this.type?"customer":"supplier"}},Object(p.mapGetters)(["employees","supplier","currentShop","profile"])),methods:{select:function(t){this.custome=t.name,this.form.account_id=t.id},filter:function(t){return t.filter(function(t){return t.id>0})},getPayMethods:function(){var t=this;Object(m.t)().then(function(e){console.log(e.data.data.data,"支付方式");var i=e.data.data.data;t.methods=t.buildData(i)}).catch(function(t){console.log(t)})},total:function(){var t=0;return this.methods.forEach(function(e){t+=~~e.amount}),t},addshopfunds:function(){var t=this;return new l.a(function(e,i){Object(h.i)({item:t.form.item_id,shop_id:t.currentShop.id,direction:t.type},"post").then(function(t){e(t.data)}).catch(function(t){i()})})},buildData:function(t){var e=[];return t.forEach(function(t){t.enabled&&(t.amount="",t.remark="",e.push(t))}),e},change:function(t){var e=this.project.find(function(e){return e.id==t});this.isAdd=!e,console.log(t,"dddd")},getfunds:function(){var t=this;Object(h.i)(null,"get").then(function(e){t.project=t.filter(e.data[t.type])})},sub:function(){function t(){return e.apply(this,arguments)}var e=r()(n.a.mark(function t(){var e,i,a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e={payment:[]},this.methods.forEach(function(t){t.amount>0&&e.payment.push({item_id:t.id,amount:1*t.amount,remark:t.remark})}),e.payment.length){t.next=5;break}return this.$message.error("请至少填写一个价格大于0"),t.abrupt("return");case 5:if(!this.isAdd){t.next=12;break}return t.next=8,this.addshopfunds();case 8:i=t.sent,this.project.push({id:i.id,item:this.form.item_id}),this.isAdd=!1,this.form.item_id=i.id;case 12:a=u()({},this.form,e,{paid_at:parseInt(this.created_at/1e3),shop_id:this.currentShop.id}),this.sendResult(a);case 14:case"end":return t.stop()}},t,this)}));return t}(),sendResult:function(t){var e=this;Object(h.g)(t).then(function(t){e.dshow=!1,e.$message({type:"success",message:"新建收款单成功,可去财务模块查看"})}).catch(function(t){console.log(t)})}},created:function(){this.form.employee_id=this.profile.id},watch:{show:function(t,e){t?(this.getPayMethods(),this.getfunds()):u()(this.$data,this.$options.data())}}},_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add_receipt"},[i("el-dialog",{attrs:{title:t.title,width:"60%",visible:t.dshow,top:"20px","append-to-body":""},on:{"update:visible":function(e){t.dshow=e}}},[i("div",{staticClass:"add_receipt-hd dflexall"},[i("div",{staticClass:"add_receipt-item flex-1"},[i("span",{staticClass:"add_receipt_title"},[t._v("付款单位：")]),t._v(" "),i("div",{staticClass:"side-el-dom el-input el-input--small",staticStyle:{width:"156px"},on:{click:function(e){t.showCustom=!0}}},[i("span",{staticClass:"el-input__inner"},[t._v("\n            "+t._s(t.custome)+"\n            "),t.custome?t._e():i("em",{staticStyle:{color:"#c8ccd3"}},[t._v("请选择")])])])]),t._v(" "),i("div",{staticClass:"add_receipt-item flex-1"},[i("span",{staticClass:"add_receipt_title"},[t._v("项目：")]),t._v(" "),i("el-select",{attrs:{placeholder:"请选择",filterable:"","allow-create":"",size:"small"},on:{change:t.change},model:{value:t.form.item_id,callback:function(e){t.$set(t.form,"item_id",e)},expression:"form.item_id"}},t._l(t.project,function(t,e){return i("el-option",{key:e,attrs:{label:t.item,value:t.id}})}))],1),t._v(" "),i("div",{staticClass:"add_receipt-item flex-1"},[i("span",{staticClass:"add_receipt_title"},[t._v("经办人：")]),t._v(" "),i("div",{staticClass:"side-el-dom el-input el-input--small",staticStyle:{width:"156px"}},[i("span",[t._v(t._s(t.profile.name))])])]),t._v(" "),i("div",{staticClass:"add_receipt-item flex-1"},[i("span",{staticClass:"add_receipt_title"},[t._v("付款日期：")]),t._v(" "),i("el-date-picker",{staticStyle:{width:"160px"},attrs:{"value-format":"timestamp",placeholder:"付款日期",size:"small"},model:{value:t.created_at,callback:function(e){t.created_at=e},expression:"created_at"}})],1)]),t._v(" "),i("div",{staticClass:"add_receipt-remark"},[i("el-input",{attrs:{size:"small",placeholder:"备注"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),i("div",{staticClass:"add_receipt-con"},[i("p",{staticClass:"add_receipt-pp"},[t._v(t._s(t.desc))]),t._v(" "),i("el-table",{attrs:{data:t.methods,border:"",height:"300px"}},[i("el-table-column",{attrs:{label:"收款账户",prop:"name",width:"120"}}),t._v(" "),i("el-table-column",{attrs:{label:"收款金额",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{type:"number",size:"mini",placeholder:"金额"},model:{value:e.row.amount,callback:function(i){t.$set(e.row,"amount",i)},expression:"scope.row.amount"}})]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-input",{attrs:{size:"mini",placeholder:"备注"},model:{value:e.row.remark,callback:function(i){t.$set(e.row,"remark",i)},expression:"scope.row.remark"}})]}}])})],1),t._v(" "),i("div",{staticClass:"add_receipt-total",staticStyle:{"font-size":"14px",padding:"10px 0"}},[i("span",{staticStyle:{display:"inline-block",width:"120px","text-align":"right"}},[t._v("总金额：")]),t._v(" "),i("em",{staticStyle:{display:"inline-block","text-align":"right"}},[t._v(t._s(t.total()))])])],1),t._v(" "),i("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"",size:"samll"},on:{click:function(e){t.dshow=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"samll"},on:{click:t.sub}},[t._v("确认")])],1)]),t._v(" "),i("hmt-payment",{attrs:{show:t.showCustom},on:{"update:show":function(e){t.showCustom=e},select:t.select}})],1)},v=[],b={render:_,staticRenderFns:v},y=b,w=i("VU/8"),k=a,x=w(f,y,!1,k,"data-v-1e01d3e2",null);e.default=x.exports}});